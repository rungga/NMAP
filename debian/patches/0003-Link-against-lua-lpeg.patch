From: Hilko Bengen <bengen@debian.org>
Date: Thu, 19 Nov 2015 23:10:17 +0100
Subject: Link against lua-lpeg

---
 configure.ac | 1 +
 nse_lpeg.cc  | 1 -
 2 files changed, 1 insertion(+), 1 deletion(-)

Index: nmap/configure.ac
===================================================================
--- nmap.orig/configure.ac
+++ nmap/configure.ac
@@ -828,6 +828,7 @@ else
   if test $have_lua != yes; then
     AC_CHECK_HEADERS([lua5.4/lua.h lua/5.4/lua.h lua.h lua/lua.h], [break])
     AC_SEARCH_LIBS(lua_isyieldable, [lua5.4 lua54 lua], [have_lua=yes],, [-lm])
+    AC_SEARCH_LIBS(luaopen_lpeg, [lua5.4-lpeg],,, [-lm])
     AC_LANG_PUSH(C)
     # We need Lua 5.4 exactly
     AC_MSG_CHECKING([for lua version == 504])
Index: nmap/nse_lpeg.cc
===================================================================
--- nmap.orig/nse_lpeg.cc
+++ nmap/nse_lpeg.cc
@@ -18,4 +18,3 @@
 #define luaL_register(L,n,f) \
 	{ if ((n) == NULL) luaL_setfuncs(L,f,0); else luaL_newlib(L,f); }
 
-#include "lpeg.c"
