Description: Report correct versions for libssh2 and zlib
 Do not report the versions from the libssh2/libssh2v.h and libz/libzv.h files,
 because they are not correct when nmap is linked against the system version of
 these (instead of the version bundled with nmap).  Instead use the version
 facility provided by the libraries themselves.
Origin: upstream
Bug: https://github.com/nmap/nmap/pull/957

--- a/nmap.cc
+++ b/nmap.cc
@@ -182,11 +182,19 @@
 #endif
 
 #if HAVE_LIBSSH2
+#ifdef LIBSSH2_INCLUDED
 #include "libssh2/libssh2v.h"
+#else
+#include "libssh2.h"
+#endif
 #endif
 
 #if HAVE_LIBZ
+#ifdef ZLIB_INCLUDED
 #include "libz/libzv.h"
+#else
+#include "zlib.h"
+#endif
 #endif
 
 /* To get the version number only. */
@@ -2846,7 +2854,7 @@
 #ifdef LIBSSH2_INCLUDED
   with.push_back(std::string("nmap-libssh2-") + get_word_or_quote(LIBSSH2_VERSION_TEXT, 1));
 #else
-  with.push_back(std::string("libssh2-") + get_word_or_quote(LIBSSH2_VERSION_TEXT, 1));
+  with.push_back(std::string("libssh2-") + get_word_or_quote(LIBSSH2_VERSION, 0));
 #endif
 #else
   without.push_back("libssh2");
@@ -2856,7 +2864,7 @@
 #ifdef ZLIB_INCLUDED
   with.push_back(std::string("nmap-libz-") + get_word_or_quote(LIBZ_VERSION_TEXT, 1));
 #else
-  with.push_back(std::string("libz-") + get_word_or_quote(LIBZ_VERSION_TEXT, 1));
+  with.push_back(std::string("libz-") + get_word_or_quote(ZLIB_VERSION, 0));
 #endif
 #else
   without.push_back("libz");
